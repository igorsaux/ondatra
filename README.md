# ONDATRA

Эмулятор 32-битного процессора RISC-V.

## Возможности

- Compile-time переключение возможностей эмулятора - поддержка расширении, PMP, проверки и т.д.
- Привилегированный режим с U и M уровнями.

### Поддерживаемые расширения

| Расширение | Описание |
|------------|----------|
| RV32I | Базовый целочисленный набор инструкций |
| M | Умножение и деление |
| F | Вещественные числа одинарной точности (float32) |
| D | Вещественные числа двойной точности (float64) |
| Zicsr | Доступ к регистрам состояния и контроля |
| Zifencei | Синхронизация кэша инструкций |
| Zba | Генерация адресов (sh1add, sh2add, sh3add) |
| Zbb | Базовые битовые операции |
| Zicntr | Базовые счетчики производительности (cycle, time, instret) |

## Бенчмарки

MacBook Air M3

```sh
+--------------------------------------fibbonacci_compilant---------------------------------------+
|  instr   |    min     |    max     |    avg     |   median   |  std_dev   | MIPS avg | MIPS max |
|----------|------------|------------|------------|------------|------------|----------|----------|
|   1962   |    14us    |    21us    |  14.895us  |    15us    |    0.66    |  131.7   |  140.1   |
+-------------------------------------------------------------------------------------------------+


+-----------------------------------------fibbonacci_fast-----------------------------------------+
|  instr   |    min     |    max     |    avg     |   median   |  std_dev   | MIPS avg | MIPS max |
|----------|------------|------------|------------|------------|------------|----------|----------|
|   1962   |    6us     |    18us    |  7.113us   |    7us     |    0.61    |  275.8   |  327.0   |
+-------------------------------------------------------------------------------------------------+


+------------------------------------floatMinMaxAbs_compilant-------------------------------------+
|  instr   |    min     |    max     |    avg     |   median   |  std_dev   | MIPS avg | MIPS max |
|----------|------------|------------|------------|------------|------------|----------|----------|
|   2141   |    15us    |    24us    |  16.702us  |    17us    |    0.66    |  128.2   |  142.7   |
+-------------------------------------------------------------------------------------------------+


+---------------------------------------floatMinMaxAbs_fast---------------------------------------+
|  instr   |    min     |    max     |    avg     |   median   |  std_dev   | MIPS avg | MIPS max |
|----------|------------|------------|------------|------------|------------|----------|----------|
|   2141   |    9us     |    34us    |  9.794us   |    10us    |    0.74    |  218.6   |  237.9   |
+-------------------------------------------------------------------------------------------------+


+------------------------------------floatArithmetic_compilant------------------------------------+
|  instr   |    min     |    max     |    avg     |   median   |  std_dev   | MIPS avg | MIPS max |
|----------|------------|------------|------------|------------|------------|----------|----------|
|   1018   |    7us     |    39us    |   8.48us   |    8us     |    0.88    |  120.0   |  145.4   |
+-------------------------------------------------------------------------------------------------+


+--------------------------------------floatArithmetic_fast---------------------------------------+
|  instr   |    min     |    max     |    avg     |   median   |  std_dev   | MIPS avg | MIPS max |
|----------|------------|------------|------------|------------|------------|----------|----------|
|   1018   |    4us     |    13us    |  4.727us   |    5us     |    0.60    |  215.4   |  254.5   |
+-------------------------------------------------------------------------------------------------+


+-------------------------------------floatSqrtFma_compilant--------------------------------------+
|  instr   |    min     |    max     |    avg     |   median   |  std_dev   | MIPS avg | MIPS max |
|----------|------------|------------|------------|------------|------------|----------|----------|
|   416    |    2us     |    8us     |  3.042us   |    3us     |    0.29    |  136.7   |  208.0   |
+-------------------------------------------------------------------------------------------------+


+----------------------------------------floatSqrtFma_fast----------------------------------------+
|  instr   |    min     |    max     |    avg     |   median   |  std_dev   | MIPS avg | MIPS max |
|----------|------------|------------|------------|------------|------------|----------|----------|
|   416    |    1us     |    9us     |  1.832us   |    2us     |    0.46    |  227.0   |  416.0   |
+-------------------------------------------------------------------------------------------------+
```
