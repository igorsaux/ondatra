# ONDATRA

Эмулятор 32-битного процессора RISC-V.

## Возможности

- Compile-time переключение возможностей эмулятора - поддержка расширении, PMP, проверки и т.д.
- Привилегированный режим с U и M уровнями.

### Поддерживаемые расширения

| Расширение | Описание |
|------------|----------|
| RV32I | Базовый целочисленный набор инструкций |
| M | Умножение и деление |
| F | Вещественные числа одинарной точности (float32) |
| D | Вещественные числа двойной точности (float64) |
| Zicsr | Доступ к регистрам состояния и контроля |
| Zifencei | Синхронизация кэша инструкций |
| Zba | Генерация адресов (sh1add, sh2add, sh3add) |
| Zbb | Базовые битовые операции |
| Zicntr | Базовые счетчики производительности (cycle, time, instret) |

## Бенчмарки

Замеры были произведены на MacBook Air M3.

### Базовые

```sh
+--------------------------------------------fibbonacci_compilant--------------------------------------------+
|  instr   |    min     |    max     |    avg     |   median   |  std_dev   | MIPS avg | MIPS min | MIPS max |
|----------|------------|------------|------------|------------|------------|----------|----------|----------|
|   1962   |    13us    |    21us    |  13.672us  |    14us    |    0.72    |  143.5   |   93.4   |  150.9   |
+------------------------------------------------------------------------------------------------------------+


+----------------------------------------------fibbonacci_fast-----------------------------------------------+
|  instr   |    min     |    max     |    avg     |   median   |  std_dev   | MIPS avg | MIPS min | MIPS max |
|----------|------------|------------|------------|------------|------------|----------|----------|----------|
|   1962   |    6us     |    35us    |  7.273us   |    7us     |    0.85    |  269.7   |   56.1   |  327.0   |
+------------------------------------------------------------------------------------------------------------+


+------------------------------------------floatMinMaxAbs_compilant------------------------------------------+
|  instr   |    min     |    max     |    avg     |   median   |  std_dev   | MIPS avg | MIPS min | MIPS max |
|----------|------------|------------|------------|------------|------------|----------|----------|----------|
|   2141   |    15us    |    23us    |  15.654us  |    16us    |    0.62    |  136.8   |   93.1   |  142.7   |
+------------------------------------------------------------------------------------------------------------+


+--------------------------------------------floatMinMaxAbs_fast---------------------------------------------+
|  instr   |    min     |    max     |    avg     |   median   |  std_dev   | MIPS avg | MIPS min | MIPS max |
|----------|------------|------------|------------|------------|------------|----------|----------|----------|
|   2141   |    8us     |    17us    |  8.433us   |    8us     |    0.64    |  253.9   |  125.9   |  267.6   |
+------------------------------------------------------------------------------------------------------------+


+-----------------------------------------floatArithmetic_compilant------------------------------------------+
|  instr   |    min     |    max     |    avg     |   median   |  std_dev   | MIPS avg | MIPS min | MIPS max |
|----------|------------|------------|------------|------------|------------|----------|----------|----------|
|   1018   |    7us     |    15us    |  7.654us   |    8us     |    0.60    |  133.0   |   67.9   |  145.4   |
+------------------------------------------------------------------------------------------------------------+


+--------------------------------------------floatArithmetic_fast--------------------------------------------+
|  instr   |    min     |    max     |    avg     |   median   |  std_dev   | MIPS avg | MIPS min | MIPS max |
|----------|------------|------------|------------|------------|------------|----------|----------|----------|
|   1018   |    3us     |    16us    |  4.258us   |    4us     |    0.59    |  239.0   |   63.6   |  339.3   |
+------------------------------------------------------------------------------------------------------------+


+-------------------------------------------floatSqrtFma_compilant-------------------------------------------+
|  instr   |    min     |    max     |    avg     |   median   |  std_dev   | MIPS avg | MIPS min | MIPS max |
|----------|------------|------------|------------|------------|------------|----------|----------|----------|
|   416    |    2us     |    37us    |  2.821us   |    3us     |    0.90    |  147.5   |   11.2   |  208.0   |
+------------------------------------------------------------------------------------------------------------+


+---------------------------------------------floatSqrtFma_fast----------------------------------------------+
|  instr   |    min     |    max     |    avg     |   median   |  std_dev   | MIPS avg | MIPS min | MIPS max |
|----------|------------|------------|------------|------------|------------|----------|----------|----------|
|   416    |    1us     |    15us    |  1.742us   |    2us     |    0.54    |  238.7   |   27.7   |  416.0   |
+------------------------------------------------------------------------------------------------------------+
```

### CoreMark

- Конфигурация `compilant`: 540
- Конфигурация `compilant` без PMP: 760
