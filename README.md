# ONDATRA

Небольшой и достаточно быстрый эмулятор 32-битного процессора RISC-V.

## Возможности

- Compile-time переключение возможностей эмулятора - поддержка расширении, PMP, проверки и т.д.
- Привилегированный режим с U и M уровнями.
- Интерпретатор.

### Поддерживаемые расширения

| Расширение | Описание |
|------------|----------|
| RV32I | Базовый целочисленный набор инструкций |
| M | Умножение и деление |
| F | Вещественные числа одинарной точности (float32) |
| Zicsr | Доступ к регистрам состояния и контроля |
| Zifencei | Синхронизация кэша инструкций |
| Zba | Генерация адресов (sh1add, sh2add, sh3add) |
| Zbb | Базовые битовые операции |
| Zicntr | Базовые счетчики производительности (cycle, time, instret) |

## Бенчмарки

Замеры были произведены на MacBook Air M3.

### Математика

<details>

```sh
+--------------------------------------------fibbonacci_compliant--------------------------------------------+
|  instr   |    min     |    max     |    avg     |   median   |  std_dev   | MIPS avg | MIPS min | MIPS max |
|----------|------------|------------|------------|------------|------------|----------|----------|----------|
|   2231   |    16us    |    24us    |  16.989us  |    17us    |    0.34    |  131.3   |   93.0   |  139.4   |
+------------------------------------------------------------------------------------------------------------+

+----------------------------------------------fibbonacci_fast-----------------------------------------------+
|  instr   |    min     |    max     |    avg     |   median   |  std_dev   | MIPS avg | MIPS min | MIPS max |
|----------|------------|------------|------------|------------|------------|----------|----------|----------|
|   2231   |    9us     |    47us    |  10.423us  |    10us    |    1.16    |  214.0   |   47.5   |  247.9   |
+------------------------------------------------------------------------------------------------------------+

+------------------------------------------floatMinMaxAbs_compliant------------------------------------------+
|  instr   |    min     |    max     |    avg     |   median   |  std_dev   | MIPS avg | MIPS min | MIPS max |
|----------|------------|------------|------------|------------|------------|----------|----------|----------|
|   1227   |    7us     |    48us    |   8.15us   |    8us     |    1.01    |  150.5   |   25.6   |  175.3   |
+------------------------------------------------------------------------------------------------------------+

+--------------------------------------------floatMinMaxAbs_fast---------------------------------------------+
|  instr   |    min     |    max     |    avg     |   median   |  std_dev   | MIPS avg | MIPS min | MIPS max |
|----------|------------|------------|------------|------------|------------|----------|----------|----------|
|   1227   |    5us     |    46us    |  6.363us   |    6us     |    1.34    |  192.8   |   26.7   |  245.4   |
+------------------------------------------------------------------------------------------------------------+

+-----------------------------------------floatArithmetic_compliant------------------------------------------+
|  instr   |    min     |    max     |    avg     |   median   |  std_dev   | MIPS avg | MIPS min | MIPS max |
|----------|------------|------------|------------|------------|------------|----------|----------|----------|
|   615    |    4us     |    12us    |  4.771us   |    5us     |    0.66    |  128.9   |   51.3   |  153.8   |
+------------------------------------------------------------------------------------------------------------+

+--------------------------------------------floatArithmetic_fast--------------------------------------------+
|  instr   |    min     |    max     |    avg     |   median   |  std_dev   | MIPS avg | MIPS min | MIPS max |
|----------|------------|------------|------------|------------|------------|----------|----------|----------|
|   615    |    3us     |    15us    |  3.603us   |    4us     |    0.66    |  170.7   |   41.0   |  205.0   |
+------------------------------------------------------------------------------------------------------------+

+-------------------------------------------floatSqrtFma_compliant-------------------------------------------+
|  instr   |    min     |    max     |    avg     |   median   |  std_dev   | MIPS avg | MIPS min | MIPS max |
|----------|------------|------------|------------|------------|------------|----------|----------|----------|
|   2513   |    15us    |    31us    |  15.908us  |    16us    |    0.86    |  158.0   |   81.1   |  167.5   |
+------------------------------------------------------------------------------------------------------------+

+---------------------------------------------floatSqrtFma_fast----------------------------------------------+
|  instr   |    min     |    max     |    avg     |   median   |  std_dev   | MIPS avg | MIPS min | MIPS max |
|----------|------------|------------|------------|------------|------------|----------|----------|----------|
|   2513   |    12us    |    20us    |  12.645us  |    13us    |    0.65    |  198.7   |  125.6   |  209.4   |
+------------------------------------------------------------------------------------------------------------+
```

</details>

### CoreMark

- Интерпретатор с конфигурацей `compliant` (10000 итераций): 382
