# ONDATRA

Эмулятор 32-битного процессора RISC-V.

## Возможности

- Compile-time переключение возможностей эмулятора - поддержка расширении, PMP, проверки и т.д.
- Привилегированный режим с U и M уровнями.

### Поддерживаемые расширения

| Расширение | Описание |
|------------|----------|
| RV32I | Базовый целочисленный набор инструкций |
| M | Умножение и деление |
| F | Вещественные числа одинарной точности (float32) |
| D | Вещественные числа двойной точности (float64) |
| Zicsr | Доступ к регистрам состояния и контроля |
| Zifencei | Синхронизация кэша инструкций |
| Zba | Генерация адресов (sh1add, sh2add, sh3add) |
| Zbb | Базовые битовые операции |
| Zicntr | Базовые счетчики производительности (cycle, time, instret) |

## Бенчмарки

MacBook Air M3

```sh
+--------------------------------------fibbonacci_compilant---------------------------------------+
|  instr   |    min     |    max     |    avg     |   median   |  std_dev   | MIPS avg | MIPS max |
|----------|------------|------------|------------|------------|------------|----------|----------|
|   1962   |    12us    |    38us    |  12.247us  |    12us    |    0.95    |  160.2   |  163.5   |
+-------------------------------------------------------------------------------------------------+


+-----------------------------------------fibbonacci_fast-----------------------------------------+
|  instr   |    min     |    max     |    avg     |   median   |  std_dev   | MIPS avg | MIPS max |
|----------|------------|------------|------------|------------|------------|----------|----------|
|   1962   |    6us     |    19us    |  6.958us   |    7us     |    0.64    |  282.0   |  327.0   |
+-------------------------------------------------------------------------------------------------+


+------------------------------------floatMinMaxAbs_compilant-------------------------------------+
|  instr   |    min     |    max     |    avg     |   median   |  std_dev   | MIPS avg | MIPS max |
|----------|------------|------------|------------|------------|------------|----------|----------|
|   2141   |    12us    |    60us    |  12.51us   |    12us    |    1.52    |  171.1   |  178.4   |
+-------------------------------------------------------------------------------------------------+


+---------------------------------------floatMinMaxAbs_fast---------------------------------------+
|  instr   |    min     |    max     |    avg     |   median   |  std_dev   | MIPS avg | MIPS max |
|----------|------------|------------|------------|------------|------------|----------|----------|
|   2141   |    8us     |    32us    |  8.269us   |    8us     |    0.94    |  258.9   |  267.6   |
+-------------------------------------------------------------------------------------------------+


+------------------------------------floatArithmetic_compilant------------------------------------+
|  instr   |    min     |    max     |    avg     |   median   |  std_dev   | MIPS avg | MIPS max |
|----------|------------|------------|------------|------------|------------|----------|----------|
|   1018   |    6us     |    33us    |   6.82us   |    7us     |    0.91    |  149.3   |  169.7   |
+-------------------------------------------------------------------------------------------------+


+--------------------------------------floatArithmetic_fast---------------------------------------+
|  instr   |    min     |    max     |    avg     |   median   |  std_dev   | MIPS avg | MIPS max |
|----------|------------|------------|------------|------------|------------|----------|----------|
|   1018   |    3us     |    41us    |  4.017us   |    4us     |    0.95    |  253.4   |  339.3   |
+-------------------------------------------------------------------------------------------------+


+-------------------------------------floatSqrtFma_compilant--------------------------------------+
|  instr   |    min     |    max     |    avg     |   median   |  std_dev   | MIPS avg | MIPS max |
|----------|------------|------------|------------|------------|------------|----------|----------|
|   416    |    2us     |    15us    |  2.694us   |    3us     |    0.60    |  154.4   |  208.0   |
+-------------------------------------------------------------------------------------------------+


+----------------------------------------floatSqrtFma_fast----------------------------------------+
|  instr   |    min     |    max     |    avg     |   median   |  std_dev   | MIPS avg | MIPS max |
|----------|------------|------------|------------|------------|------------|----------|----------|
|   416    |    1us     |    33us    |  1.719us   |    2us     |    0.84    |  242.0   |  416.0   |
+-------------------------------------------------------------------------------------------------+
```
